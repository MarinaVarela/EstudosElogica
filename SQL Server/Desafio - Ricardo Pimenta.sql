-- CRIAÇÃO DO BANCO DE DADOS
CREATE DATABASE BIBLIOTECA_MARINA;
USE BIBLIOTECA_MARINA;

-- CRIAÇÃO DAS TABELAS
CREATE TABLE AUTORES (
	ID_AUT INT NOT NULL PRIMARY KEY,
	NOME VARCHAR (100) NOT NULL,
	DATA_NASCIMENTO CHAR(8));

CREATE TABLE LIVROS (
	ID_LIV INT NOT NULL PRIMARY KEY,
	TITULO VARCHAR(200) NOT NULL,
	ID_AUT INT NOT NULL REFERENCES AUTORES (ID_AUT));

CREATE TABLE EMPRESTIMO (
	ID_EMP INT NOT NULL PRIMARY KEY,
	ID_LIV INT NOT NULL REFERENCES LIVROS (ID_LIV),
	DATA_EMP CHAR(8),
	DATA_DEV CHAR(8));

-- ADICIONANDO OS VALORES NAS TABELAS PELO INSERT
INSERT INTO AUTORES VALUES
(1, 'Maria Lispector', '19950201'),
(2, 'Arnaldo Suassuna', '19500501'),
(3, 'Reinaldo Rosa', '19870206'),
(4, 'Julio Conde', '19200804'),
(5, 'Juvenal Rossi', '19700901')

INSERT INTO LIVROS VALUES
(1, 'A Raposa e as uvas', 5),
(6, 'Boemia na noite recifense', 5),
(2, 'Não devo nada a ninguém', 4),
(8, 'Sport no coração', 2),
(3, 'O alto da compadecida', 2),
(4, 'Poemas de beira de estrada', 3),
(5, 'Histórias de Macabéia', 1),
(7, 'Cartas para meu eu', 1)

INSERT INTO EMPRESTIMO VALUES
(1, 3, '20230801', '20230803'),
(2, 5, '20230802', '20230804'),
(3, 7, '20230803', '20230805'),
(4, 8, '20230804', '20230806'),
(5, 4, '20230805', '20230807'),
(6, 1, '20230807', '20230809'),
(7, 2, '20230807', '20230809'),
(8, 6, '20230808', '20230810')

-- SELECTS 
SELECT * FROM AUTORES
SELECT * FROM LIVROS
SELECT * FROM EMPRESTIMO

-- LISTAR TODOS OS AUTORES E SEUS LIVROS
SELECT AUT.NOME, LIV.TITULO
FROM AUTORES AUT
	INNER JOIN LIVROS LIV
	ON AUT.ID_AUT = LIV.ID_AUT
ORDER BY AUT.NOME

-- TODOS EMPRESTIMOS E DATA DE DEVOLUÇÃO
SELECT LIV.TITULO, EMP.DATA_EMP, EMP.DATA_DEV
FROM EMPRESTIMO EMP
	INNER JOIN LIVROS LIV
	ON EMP.ID_LIV = LIV.ID_LIV

-- LIVROS AINDA NÃO DEVOLVIDOS
SELECT LIV.TITULO, EMP.DATA_EMP DATA_DE_EMPRESTIMO, EMP.DATA_DEV DATA_DE_DEVOLUCAO, 
(CASE WHEN CONVERT(CHAR(8), EMP.DATA_DEV, 105) >= GETDATE() THEN 'Não devolvido'
ELSE 'Devolvido' END) STATUS_DEVOLUÇÃO
FROM EMPRESTIMO EMP
	INNER JOIN LIVROS LIV 
	ON EMP.ID_LIV = LIV.ID_LIV
WHERE CONVERT(CHAR(8), EMP.DATA_DEV, 105) >= GETDATE()

-- ALTERAÇÕES NA TABELA PELO UPDATE
UPDATE AUTORES SET NOME = 'José Rossi' WHERE NOME = 'Juvenal Rossi'
SELECT*FROM AUTORES

UPDATE LIVROS SET TITULO = 'A Raposa e as maças' WHERE TITULO = 'A Raposa e as uvas'
SELECT * FROM LIVROS

UPDATE EMPRESTIMO SET DATA_EMP = '20230808', DATA_DEV = '20230810' WHERE ID_LIV = 3 
SELECT * FROM EMPRESTIMO
-- ACHO QUE É MAIS INTERESSANTE UM NOVO INSERT INTO EMPRESTIMO VALUES (9, 3, '20230808', '20230810')

-- DELETANDO
DELETE FROM EMPRESTIMO WHERE ID_EMP = 5
DELETE FROM LIVROS WHERE ID_LIV = 4
DELETE FROM AUTORES WHERE ID_AUT = 3

SELECT * FROM AUTORES
SELECT * FROM LIVROS
SELECT * FROM EMPRESTIMO